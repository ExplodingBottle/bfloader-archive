<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>bfloader - Blackfin Flash Tools</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1"></a>bfloader - Blackfin Flash Tools</h2></div><div><div class="author"><h3 class="author"><span class="othername">section5</span></h3></div></div><div><p class="releaseinfo">v0.3</p></div></div><hr></div><div class="toc"><dl><dt><span class="section"><a href="#sec_intro">1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e41">2. Usage</a></span></dt><dd><dl><dt><span class="section"><a href="#sec_bfloader">2.1. bfloader scripts</a></span></dt><dt><span class="section"><a href="#d0e89">2.2. Standalone flashloader</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e99">2.2.1. Compilation of flashloader</a></span></dt><dt><span class="section"><a href="#d0e113">2.2.2. Command options</a></span></dt><dt><span class="section"><a href="#d0e221">2.2.3. Examples</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#d0e265">3. License</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec_intro"></a>1.&nbsp;Introduction</h2></div></div></div><p>The bfloader Flash tools for Blackfin is a collection of scripts and a standalone executable to program flashes on several supported platforms. The source code of the flash loader backends is included so that the user can easily adapt the code to custom platforms. The standalone executable requires a JTAG adapter such as the ICEbear (<a href="http://www.section5.ch/icebear" target="_top">www.section5.ch/icebear</a>)</p><p>Currently supported platforms:</p><div class="itemizedlist"><ul type="disc"><li><p>STAMP BF533/BF537 (EZKIT BF537), EZKIT BF561 (Analog Devices, <a href="http://blackfin.uclinux.org" target="_top">blackfin.uclinux.org</a>)</p></li><li><p>ZBrain BF533 (Schmid Engineering, <a href="http://www.zbrain.c" target="_top">www.zbrain.ch</a>)</p></li><li><p>CM-BF533, CM-BF537 (Bluetechnix, <a href="http://www.tinyboards.com" target="_top">www.tinyboards.com</a>)</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e41"></a>2.&nbsp;Usage</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="sec_bfloader"></a>2.1.&nbsp;bfloader scripts</h3></div></div></div><p>To use the bfloader scripts, you must have a working installation of the ICEbear software. See also ICEbear manual at <a href="http://www.section5.ch/icebear" target="_top">www.section5.ch/icebear</a>.</p><p>These are the steps you normally take to get your flash programmed:</p><div class="orderedlist"><ol type="1"><li><p>Make sure the ICEbear is connected and <code class="filename">gdbproxy</code> is running.</p></li><li><p>Enter the board directory matching your board</p></li><li><p>Edit <code class="filename">flashload.sh</code> and change the location of the flash images, if necessary</p></li><li><p>Edit <code class="filename">.gdbinit</code>, if necessary.</p></li><li><p>Run the <code class="filename">flashload.sh</code> script: <span><strong class="command">./flashload.sh</strong></span></p></li></ol></div><p>The flash programming happens via some scripted interaction between GDB and the loader backend <code class="filename">bfloader.dxe</code>. This loader backend is downloaded to the target in the beginning, analogous to the flash tool in Visual DSP++. For your own board, you will have to adapt the source from a similar board and compile using the board directory's Makefile.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e89"></a>2.2.&nbsp;Standalone flashloader</h3></div></div></div><p>This standalone executable does not require gdbproxy to run. Parameters are passed with option flags like shown below:</p><p><code class="computeroutput">./flashload --info --backend=zbrain/bfloader.dxe --eraseall --program=zbrain/vmImage</code></p><p>The description of command options is listed in the table below. Running the flashloader without arguments displays a list of supported options.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e99"></a>2.2.1.&nbsp;Compilation of flashloader</h4></div></div></div><p>If you have downloaded the flash loader as source package, you will have to build it first. Just type <span><strong class="command">make</strong></span> from the top directory. If the necessary libraries can not be found, install the binary packages for libbfemu. These are found on the section5 software page <a href="http://www.section5.ch/software" target="_top">www.section5.ch/software</a>. You also need to have a developer package of libelf installed.The loader backends are normally precompiled, but you can recompile them by entering the board subdirectory and running <span><strong class="command">make</strong></span> again. This relies on a working blackfin GNU toolchain.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e113"></a>2.2.2.&nbsp;Command options</h4></div></div></div><div class="table"><a name="d0e116"></a><p class="title"><b>Table&nbsp;1.&nbsp;List of command options</b></p><table summary="List of command options" border="1"><colgroup><col width="25%"><col width="75%" align="justify"></colgroup><thead><tr><th align="center">Option name</th><th align="center">Description</th></tr></thead><tbody><tr><td>info</td><td align="justify">Displays information about flash driver and flash geometry</td></tr><tr><td>version</td><td align="justify">Displays the program version</td></tr><tr><td>program=&lt;filename&gt;</td><td align="justify">Write the binary image in file with name <code class="option">filename</code> to flash. If none of the <code class="option">size</code> and <code class="option">offset</code> options are specified, offset is assumed 0 and size the size of the file.</td></tr><tr><td>dump=&lt;filename&gt;</td><td align="justify">Dump the content of the flash specified by <code class="option">offset</code> and <code class="option">size</code> to a file. Specifying size is mandatory.</td></tr><tr><td>compare=&lt;filename&gt;</td><td align="justify">Compare flash content with the binary image in the given file. If specified, the comparison is started from <code class="option">offset</code> up to <code class="option">size</code>. Otherwise, offset is assumed to be 0 and size to be the size of the file.</td></tr><tr><td>eraseall</td><td align="justify">Erase entire Flash chip. This can take up to a few minutes, so do not interrupt the process.</td></tr><tr><td>erasesectors=&lt;off&gt;,&lt;n&gt;</td><td align="justify">Specify the number of sectors <code class="option">n</code> to erase, starting from sector number <code class="option">off</code>.You must know the sector geometry of the Flash in order to determine the corresponding addresses. This option is only relevant when you use a partitioned flash.</td></tr><tr><td>offset=&lt;Address in hex&gt;</td><td align="justify">Specifies an offset in hexadecimal format. You must use a prefix '0x' for this hexadecimal number, e.g. --offset=0x1000.</td></tr><tr><td>size=&lt;Size in hex&gt;</td><td align="justify">Specifies a maximum size to read, write, or compare. The format is the same as in the <code class="option">offset</code> option.</td></tr><tr><td>noverify</td><td align="justify">Turn of verify after write.Verify is always on by default, if this option is not specified.</td></tr><tr><td>backend=&lt;backend&gt;</td><td align="justify">Specify the loader backend to load on initialization. If not specified, the default compiled in backend name ('bfloader.dxe' in the current working directory) is used. This must be a valid bfloader backend, VDSP backends can not be used.</td></tr><tr><td>speed=&lt;value&gt;</td><td align="justify">Change JTAG clock speed. 0: fastest, 255: slowest. Note that too low clock speeds (values &gt; 4) might not work. Default is 1.</td></tr></tbody></table></div><p>Note that all file related actions (program, dump, compare) can only be used at a time.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e221"></a>2.2.3.&nbsp;Examples</h4></div></div></div><p>Here is a list of examples on how to use the flashloader. Note that this assumes the appropriate backend (<code class="filename">bfloader.dxe</code>) in the current working directory.</p><div class="variablelist"><dl><dt><span class="term">Erase and program a flash with a full flash image</span></dt><dd><p><code class="computeroutput">./flashload --eraseall --program=flash.img</code></p></dd><dt><span class="term">Program a flash with a partial flash image from offset 0x10000</span></dt><dd><p><code class="computeroutput">./flashload --program=flash.img --offset=0x10000</code></p></dd><dt><span class="term">Partial erase of flash</span></dt><dd><p><code class="computeroutput">./flashload --erasesectors=0,32</code></p></dd><dt><span class="term">Verify flash content against binary file image</span></dt><dd><p><code class="computeroutput">./flashload --compare=flash.img</code></p></dd><dt><span class="term">Read first 1M partition of a boot flash</span></dt><dd><p><code class="computeroutput">./flashload --dump=flash_read.img --offset=0x0 --size=0x100000</code></p></dd></dl></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e265"></a>3.&nbsp;License</h2></div></div></div><p>This program collection is provided 'as is', without warranty. You may adapt and reuse the source code as you wish, as long as you do not remove the copyright information If you develop a nice feature or a backend that might be useful to others, please be so fair and return your changes back into the open source repository.</p></div></div></body></html>